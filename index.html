<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz Versets Coran Avancé</title>
<style>
  body { font-family: Arial, sans-serif; margin: 5px; max-width: 100%; padding: 0 5px; font-size: 14px; }
  h1 { font-size: 1.2em; text-align: center; margin-bottom: 6px; }
  label, select, input { font-size: 0.9em; margin: 0 4px 6px 0; }
  input[type=number] { width: 50px; }
  .range-wrap { display: flex; gap: 6px; align-items: center; }
  .rtl-range { direction: rtl; }
  .controls { margin-bottom: 8px; display: flex; gap: 6px; flex-wrap: nowrap; }
  button { padding: 4px 8px; font-size: 0.9em; cursor: pointer; }
  .table-wrap { display: flex; flex-wrap: wrap; gap: 6px; max-height: 160px; overflow-y: auto; border: 1px solid #ccc; padding: 4px; background: #fafafa; user-select: none; }
  .num { border-radius: 5px; padding: 6px 10px; background: #d2f0d2; border: 1px solid #84b784; cursor: pointer; transition: background-color 0.3s; min-width: 36px; text-align: center; font-size: 0.95em; }
  .num.traited.correct { background-color: #0b3d0b; color: #d8f5d8; cursor: default; border-color: #064206; text-decoration: line-through; }
  .num.traited.incorrect { background-color: #8b1c1c; color: #f5d8d8; cursor: default; border-color: #5e1212; text-decoration: line-through; }
  /* simplifié */
</style>
</head>
<body>

<h1 id="app-title">اختبار آيات القرآن المتقدم</h1>
<label for="language" id="label-language">اللغة :</label>
<select id="language">
  <option value="ar">العربية</option>
  <option value="fr">Français</option>
  <option value="en">English</option>
  <option value="es">Español</option>
</select>

<label for="sourah" id="label-sourah">السورة :</label>
<select id="sourah"></select>

<div id="range-wrap" class="range-wrap">
  <label for="start" id="label-start">بداية :</label>
  <input type="number" id="start" min="1"/>
  <label for="end" id="label-end">نهاية :</label>
  <input type="number" id="end" min="1"/>
</div>

<div class="controls">
  <button id="btnRedistribuer">إعادة التوزيع</button>
  <button id="btnTrier">ترتيب</button>
  <button id="btnToggleTraites">إظهار / إخفاء المعالَجَة</button>
</div>

<div class="table-wrap" id="ayah-numbers"></div>

<script>
(() => {
  // Liste source minimale pour test
  const SURAHS = [
    {number: 1, name_ar: "الفاتحة", name_fr: "Al-Fatiha", count: 7},
    {number: 2, name_ar: "البقرة", name_fr: "Al-Baqara", count: 286}
    // ajoutez les autres sourates ici au besoin
  ]; 

  const sourahEl = document.getElementById("sourah");
  const startEl = document.getElementById("start");
  const endEl = document.getElementById("end");
  const ayahContainer = document.getElementById("ayah-numbers");

  let ayahNumbers = [];
  let traitedMap = new Map();
  let showTreated = true;

  function populateSourates() {
    sourahEl.innerHTML = "";
    SURAHS.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s.number;
      opt.text = `${s.number} - ${s.name_ar} (${s.name_fr})`;
      sourahEl.appendChild(opt);
    });
  }

  function updateRange() {
    const sel = SURAHS.find(s => s.number == sourahEl.value);
    if (!sel) return;
    startEl.min = 1;
    startEl.max = sel.count;
    startEl.value = 1;
    endEl.min = 1;
    endEl.max = sel.count;
    endEl.value = sel.count;
  }

  function validateInputs() {
    const sel = SURAHS.find(s => s.number == sourahEl.value);
    if (!sel) return false;
    let maxVerset = sel.count;
    let startVal = parseInt(startEl.value);
    let endVal = parseInt(endEl.value);
    if (isNaN(startVal) || startVal < 1) startVal = 1;
    if (isNaN(endVal) || endVal < 1) endVal = 1;
    if (startVal > maxVerset) startVal = maxVerset;
    if (endVal > maxVerset) endVal = maxVerset;
    if (startVal > endVal) startVal = endVal;
    startEl.value = startVal;
    endEl.value = endVal;
    return true;
  }

  function shuffleAyahs() {
    if (!validateInputs()) return;
    ayahNumbers = [];
    for (let i = +startEl.value; i <= +endEl.value; i++) ayahNumbers.push(i);
    // shuffle Fisher-Yates
    for (let i = ayahNumbers.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [ayahNumbers[i], ayahNumbers[j]] = [ayahNumbers[j], ayahNumbers[i]];
    }
    traitedMap.clear();
    renderAyahs();
  }

  function renderAyahs() {
    ayahContainer.innerHTML = "";
    ayahNumbers.forEach(num => {
      const div = document.createElement("div");
      div.classList.add("num");
      // Status non géré dans cette version simplifiée
      div.textContent = num;
      div.onclick = () => alert('Verset ' + num);
      ayahContainer.appendChild(div);
    });
  }

  // Au changement des valeurs, remplit et rafraîchit la grille
  sourahEl.addEventListener("change", () => {
    updateRange();
    shuffleAyahs();
  });
  startEl.addEventListener("change", shuffleAyahs);
  endEl.addEventListener("change", shuffleAyahs);

  // Démarrage
  populateSourates();
  sourahEl.value = 1;
  updateRange();
  shuffleAyahs();

})();
</script>

</body>
</html>
